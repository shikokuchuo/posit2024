---
format:
   revealjs:
     slide-number: true
     footer: "&copy; 2024 Hikbiki AI Limited, Eli Lilly and Company"
     view-distance: 100
     mobile-view-distance: 100
---

##

```{r, include = FALSE, echo = FALSE}
knitr::opts_chunk$set(
  cache = FALSE,
  comment = "#>",
  fig.width = 10, 
  fig.height = 5
)
```

<style>
.reveal .tiny {
  display: inline-block;
  font-size: 0.5em;
  line-height: 1.0em;
  vertical-align: top;
}
.reveal .medium {
  display: inline-block;
  font-size: 0.75em;
  line-height: 1.5em;
  vertical-align: top;
}
</style>

<center>
<br>
<h4>`mirai` and `crew`: next-generation async to supercharge `promises`, Plumber, Shiny, and `targets`</h4>
<img src="./images/title.png" height="400px">
<br>
<h4>Charlie Gao and Will Landau</h4>
</center>

## 

<center>
<img src="./images/mirai.png">
</center>

## 

<center>
<img src="./images/crew.png">
</center>

## Why `crew`?

<center>
<img src="./images/plugins.png" width=750>
</center>

* Extends `mirai` to distributed computing.
* Plugin system for clusters and cloud services.
* Central interface and worker auto-scaling.
* Works with Shiny, `promises`, and `targets`.

## `crew` basics

:::: {.columns}

::: {.column width="75%"}

```r
# Start a controller.
library(crew)
controller <- crew_controller_local(
  workers = 2,
  seconds_idle = 10
)
controller$start()

# Submit tasks asynchronously.
controller$push(command = 1 + 1)
controller$push(command = sqrt(9))

# Wait for a task to finish.
controller$wait(mode = "one")

# Collect the result.
controller$pop()$result[[1]]
#> [1] 3
```

:::

::: {.column width="25%"}

<img src="./images/crew.png">

:::

::::

## SLURM plugin

:::: {.columns}

::: {.column width="75%"}

```r
# Start a controller with many workers.
library(crew.cluster)
controller <- crew_controller_slurm(
  workers = 100,
  slurm_cpus_per_task = 4,
  seconds_idle = 120,
  script_lines = "module load R"
)
controller$start()

# Submit many tasks asynchronously.
controller$walk(
  command = your_expensive_task(data = object),
  iterate = list(object = list_of_objects),
  data = list(expensive_task = expensive_task)
)
```

:::

::: {.column width="25%"}

<img src="./images/crew.cluster.png">

:::

::::

